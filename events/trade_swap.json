{
    "id": "trade_swap",
    "description": "Fired when someone exchanges tokens.",
    "category": "Trade",
    "sql_insert": [
        "INSERT INTO trade_swap_events (balance_changes, trader, transaction_id, receipt_id, block_height, block_timestamp) SELECT (elem->>'balance_changes')::jsonb, elem->>'trader', elem->>'transaction_id', elem->>'receipt_id', (elem->>'block_height')::bigint, to_timestamp((elem->>'block_timestamp_nanosec')::numeric / 1000000000) at time zone 'UTC' FROM jsonb_array_elements($1::jsonb) AS elem"
    ],
    "endpoints": [
        {
            "route": "by_token_newest",
            "query": "SELECT jsonb_agg(jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text)) FROM (SELECT * FROM trade_swap_events WHERE balance_changes ? ($1->>'account') ORDER BY id DESC LIMIT 50) subq"
        },
        {
            "route": "by_token_oldest",
            "query": "SELECT jsonb_agg(jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text)) FROM (SELECT * FROM trade_swap_events WHERE balance_changes ? ($1->>'account') ORDER BY id ASC LIMIT 50) subq"
        },
        {
            "route": "latest",
            "query": "SELECT jsonb_agg(jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text)) FROM (SELECT * FROM trade_swap_events ORDER BY id DESC LIMIT 50) subq"
        },
        {
            "route": "oldest",
            "query": "SELECT jsonb_agg(jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text)) FROM (SELECT * FROM trade_swap_events ORDER BY id ASC LIMIT 50) subq"
        },
        {
            "route": "by_trader_newest",
            "query": "SELECT jsonb_agg(jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text)) FROM (SELECT * FROM trade_swap_events WHERE trader = ($1->>'trader') ORDER BY id DESC LIMIT 50) subq"
        },
        {
            "route": "by_trader_oldest",
            "query": "SELECT jsonb_agg(jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text)) FROM (SELECT * FROM trade_swap_events WHERE trader = ($1->>'trader') ORDER BY id ASC LIMIT 50) subq"
        },
        {
            "route": "by_transaction",
            "query": "SELECT jsonb_build_object('balance_changes', balance_changes, 'trader', trader, 'transaction_id', transaction_id, 'receipt_id', receipt_id, 'block_height', block_height, 'block_timestamp_nanosec', ((extract(epoch from block_timestamp) * 1000000000)::bigint)::text) FROM trade_swap_events WHERE transaction_id = ($1->>'transaction_id')"
        }
    ]
}